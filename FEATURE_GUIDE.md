# ğŸ’ Love Diary & Wardrobe Feature Guide

## ğŸ¯ Overview

This guide covers two new core features that enhance user engagement and monetization:

1. **Love Diary** - Emotional retention through memory collection
2. **Wardrobe** - Visual customization and monetization

---

## ğŸ“– Feature 1: Love Diary

### ğŸ¨ Design Philosophy

**Goal**: Create emotional attachment through memory accumulation

**Key Insights**:
- Female users value emotional connection over technical features
- Memories and milestones create strong retention hooks
- Nostalgia is a powerful engagement driver

### ğŸ“± User Flow

```
Dating Page â†’ Diary Button â†’ Love Diary Page
                              â”œâ”€â”€ Timeline Tab (view memories)
                              â””â”€â”€ Statistics Tab (relationship data)
```

### ğŸ”§ Implementation Details

**Data Model** (`diary_entry.dart`):
```dart
class DiaryEntry {
  final int id;                          // Numeric ID
  final String roleId;                    // Which AI role
  final DiaryType type;                   // Entry type
  final String title;                     // Title
  final String content;                   // Main content
  final DateTime timestamp;               // Creation time
  final List<String> mediaUrls;          // Photos/videos (renamed from imageUrls)
  final Map<String, dynamic>? metadata;  // Additional data
}

enum DiaryType {
  firstMeet, chatMoment, sceneDate, songMemory,
  giftReceived, milestone, userNote, anniversary
}
```

**Simplified Fields**:
- Changed `id` from String to `int` for better database compatibility
- Renamed `imageUrls` to `mediaUrls` to support both images and videos
- Removed `isAutoGenerated` (can be inferred from metadata or type)
- Removed `emotionScore` (simplified model)

**UI Components**:
- Timeline view with beautiful cards
- Each entry has emoji icon by type
- Support for multiple media attachments (images/videos)
- Clean and simple card design

**Statistics View**:
- Total days together
- Message count
- Date count
- Songs shared
- Gifts received
- Milestone achievements

### ğŸ¤– Auto-Generation Logic

**Triggers** (to be implemented):
```dart
// In chat_message.dart
if (isFirstMessage) {
  createDiaryEntry(type: DiaryType.firstMeet);
}

// In dating_page.dart
void _selectScene(DateScene scene) {
  createDiaryEntry(
    type: DiaryType.sceneDate,
    metadata: {'sceneName': scene.name}
  );
}

// In audio_player
void _playSong(Song song) {
  createDiaryEntry(
    type: DiaryType.songMemory,
    metadata: {'songTitle': song.title}
  );
}
```

### ğŸ“Š Milestones System

**Default Milestones**:
- 7 days together ğŸ‰
- 30 days together ğŸ’•
- 100 days together ğŸ’¯
- 1 year together ğŸŠ
- 100 messages ğŸ’¬
- 500 messages ğŸ’¬ğŸ’¬
- 1000 messages ğŸ’¬ğŸ’¬ğŸ’¬
- First date ğŸ“
- First song ğŸµ
- First gift ğŸ

**Unlock Rewards** (future):
- Unlock special outfits
- Unlock new scenes
- Unlock special voice lines

---

## ğŸ‘” Feature 2: Wardrobe

### ğŸ¨ Design Philosophy

**Goal**: Monetization through visual customization

**Key Insights**:
- Women love dressing up characters
- Rarity levels create collection desire
- Limited editions create urgency
- Virtual currency enables F2P model

### ğŸ“± User Flow

```
Dating Page â†’ Gift Button â†’ Wardrobe Page
                            â”œâ”€â”€ Category Filter
                            â”œâ”€â”€ Outfit Grid
                            â””â”€â”€ Purchase/Equip
```

### ğŸ”§ Implementation Details

**Data Model** (`outfit.dart`):
```dart
class Outfit {
  - id, name, description, category
  - thumbnailUrl, previewUrl
  - rarity, price, isUnlocked
  - isLimited, availableUntil
  - tags, aiPrompt
}

enum OutfitCategory {
  casual, formal, traditional, sportswear,
  pajamas, costume, seasonal, wedding, fantasy
}

enum OutfitRarity {
  common (gray), rare (blue),
  epic (purple), legendary (gold)
}
```

**UI Components**:
- Grid layout (2 columns)
- Category filter chips
- Rarity color coding
- Limited edition badges
- Lock/unlock states
- Equipped indicator
- Coin balance display

### ğŸ’° Monetization Strategy

**Pricing Tiers**:
- Common: FREE (starter outfits)
- Rare: 100-200 coins
- Epic: 300-500 coins
- Legendary: 800-1200 coins
- Limited: 1000+ coins

**Coin Economy**:
```
Earning Coins:
- New user bonus: 500 coins
- Daily login: 50 coins
- Complete chat task: 100 coins/day
- Watch ad: 20 coins (max 3/day)
- Invite friend: 200 coins

Spending Coins:
- Outfits: 100-1200 coins
- Unlock scenes: 200 coins
- Unlock songs: 150 coins

Purchasing Coins:
- $0.99 = 100 coins (first time double)
- $4.99 = 600 coins
- $9.99 = 1300 coins
- $19.99 = 3000 coins
- Monthly Card: $4.99 = 100 coins/day for 30 days
```

### ğŸ¨ AI Outfit Generation (Future Implementation)

**Tech Stack Option 1: Replicate API**
```dart
Future<String> generateOutfitImage({
  required String baseImageUrl,
  required Outfit outfit,
}) async {
  final response = await http.post(
    'https://api.replicate.com/v1/predictions',
    headers: {'Authorization': 'Bearer $REPLICATE_API_KEY'},
    body: jsonEncode({
      'version': 'stable-diffusion-controlnet-version',
      'input': {
        'image': baseImageUrl,
        'prompt': outfit.aiPrompt['prompt'],
        'negative_prompt': 'low quality, blurry',
        'controlnet_conditioning_scale': 0.8,
      }
    }),
  );

  // Poll for result
  final predictionId = response['id'];
  return await pollForResult(predictionId);
}
```

**Tech Stack Option 2: Custom Backend**
- Host own Stable Diffusion model
- Use ControlNet for pose preservation
- Cache generated images
- Pre-generate popular combinations

**Image Caching Strategy**:
```dart
class OutfitImageCache {
  // Cache key: roleId_outfitId
  static Map<String, String> _cache = {};

  Future<String> getOutfitImage(String roleId, String outfitId) async {
    final cacheKey = '${roleId}_$outfitId';

    if (_cache.containsKey(cacheKey)) {
      return _cache[cacheKey]!;
    }

    // Generate new image
    final imageUrl = await generateOutfitImage(...);
    _cache[cacheKey] = imageUrl;

    return imageUrl;
  }
}
```

---

## ğŸ”Œ API Integration

### Required Endpoints

**Diary APIs**:
```dart
// GET /api/diary/list?roleId={roleId}&page={page}&pageSize={pageSize}
// Response: {entries: [...], total: 123}
Future<List<DiaryEntry>> getDiaryList(String roleId);

// POST /api/diary/create
// Body: {roleId, type, title, content, mediaUrls, metadata}
// Response: {id: 1, ...}
Future<DiaryEntry> createDiary(DiaryEntry entry);

// GET /api/diary/stats?roleId={roleId}
// Response: {totalDays: 30, totalMessages: 156, ...}
Future<RelationshipStats> getDiaryStats(String roleId);

// PUT /api/diary/update/{id}
// Body: {title, content, mediaUrls, metadata}
Future<DiaryEntry> updateDiary(int id, DiaryEntry entry);

// DELETE /api/diary/delete/{id}
Future<void> deleteDiary(int id);
```

**Outfit APIs**:
```dart
// GET /api/outfit/list?category={category}
Future<List<Outfit>> getOutfitList({OutfitCategory? category});

// GET /api/outfit/character?roleId={roleId}
Future<CharacterOutfit> getCharacterOutfit(String roleId);

// POST /api/outfit/purchase
// Body: {outfitId, roleId}
Future<PurchaseResult> purchaseOutfit(String outfitId, String roleId);

// POST /api/outfit/equip
// Body: {outfitId, roleId}
Future<void> equipOutfit(String outfitId, String roleId);

// POST /api/outfit/generate
// Body: {roleId, outfitId}
Future<String> generateOutfitImage(String roleId, String outfitId);
```

**Coin APIs**:
```dart
// GET /api/user/coins
Future<int> getUserCoins();

// POST /api/user/coins/purchase
// Body: {packageId, receipt}
Future<PurchaseResult> purchaseCoins(String packageId, String receipt);

// POST /api/user/coins/earn
// Body: {taskType, taskId}
Future<int> earnCoins(String taskType);
```

---

## ğŸ“ˆ Metrics to Track

### Engagement Metrics
- Daily Active Users (DAU)
- Session length
- Diary entries created per user
- Outfit changes per session
- Return rate after milestone unlock

### Monetization Metrics
- Conversion rate (free â†’ paid)
- Average Revenue Per User (ARPU)
- Lifetime Value (LTV)
- Most purchased outfits
- Average coins spent per user

### Content Metrics
- Most used outfit categories
- Most unlocked milestones
- Average diary entries per user
- Photo attachment rate

---

## ğŸ¯ Next Steps

### Week 1-2: Foundation
- [ ] Implement diary API service layer
- [ ] Implement outfit API service layer
- [ ] Add image picker for diary photos
- [ ] Add share functionality for diary

### Week 3-4: Auto-Generation
- [ ] Auto-create first meet diary
- [ ] Auto-create scene date diary
- [ ] Auto-create song memory diary
- [ ] Implement milestone detection

### Week 5-6: AI Generation
- [ ] Research Replicate API vs custom solution
- [ ] Implement outfit image generation
- [ ] Add loading states and progress
- [ ] Implement image caching

### Week 7-8: Monetization
- [ ] Implement coin purchase flow
- [ ] Add daily tasks system
- [ ] Add monthly card
- [ ] Implement limited-time offers

### Week 9-10: Polish
- [ ] Add animations
- [ ] Add sound effects
- [ ] Optimize performance
- [ ] Add analytics tracking

---

## ğŸ’¡ Advanced Features (Future)

### Diary Enhancements
- **Year in Review**: Auto-generate annual summary video
- **Time Capsule**: Schedule future diary unlock
- **Voice Diary**: Record voice memos
- **Mood Tracking**: Emotion curve visualization
- **Export**: PDF/video export for sharing

### Wardrobe Enhancements
- **Outfit Sets**: Complete outfit combinations
- **Accessories**: Jewelry, bags, shoes
- **Color Customization**: Dye system
- **User Design**: Custom outfit creator
- **Fashion Show**: AR try-on feature

### Social Features
- **Sharing**: Share diary moments to social media
- **Friends**: View friends' relationship stats
- **Leaderboard**: Compete on relationship days
- **Gifts**: Send outfits to friends

---

## ğŸš€ Launch Checklist

### Pre-Launch
- [ ] All core APIs implemented
- [ ] UI/UX tested on multiple devices
- [ ] Performance optimized
- [ ] Analytics integrated
- [ ] Payment tested (sandbox)
- [ ] Tutorial/onboarding created

### Soft Launch
- [ ] Launch to small user group
- [ ] Monitor crash reports
- [ ] Track conversion funnel
- [ ] Gather user feedback
- [ ] A/B test pricing

### Full Launch
- [ ] Marketing materials ready
- [ ] App store assets updated
- [ ] Customer support prepared
- [ ] Monitor server load
- [ ] Track key metrics

---

## ğŸ“ Support

For implementation questions or technical support, contact the development team.

**Happy Coding! ğŸ’–**
